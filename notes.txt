################################################################################
# Inventory
################################################################################

./bin/crane export

- These endpoints do not have ownerReferences, despite them being derived by
the Service?

I'm finding I have to dump the export directory and basically manually whitelist
a lot of things.

I need to be able to log from plugins, how do we want people to do that?
Well defined interface that tells the main process: "log this"?

Add remove status to kube plugin

What about the root-ca configmap?

# ./bin/crane transfer-pvc --skip-quiesce --local --source-context=ie --source-pvc-name=data-inventory-postgresql-0 --destination-pvc-namespace=inventory-erik-tgt
2021/08/31 14:57:15 services "data-inventory-postgresql-0" already existsunable to create endpoint

RoleBinding requires me to strip a lot of stuff that causes argo to not want
to reconcile my rolebinding

################################################################################
Need:
        ├── ConfigMap_inventory-erik_inventory-config.yaml
        ├── ConfigMap_inventory-erik_kube-root-ca.crt.yaml
        ├── Deployment_inventory-erik_inventory.yaml
        ├── Ingress_inventory-erik_inventory.yaml
        ├── RoleBinding_inventory-erik_default-view.yaml
        ├── Secret_inventory-erik_inventory-postgresql.yaml
        ├── Secret_inventory-erik_inventory-secret.yaml
        ├── Service_inventory-erik_inventory-postgresql-headless.yaml
        ├── Service_inventory-erik_inventory-postgresql.yaml
        ├── Service_inventory-erik_inventory.yaml
        └── StatefulSet_inventory-erik_inventory-postgresql.yaml
Drop:
-> Derived from StatefulSet
X        ├── ControllerRevision_inventory-erik_inventory-postgresql-67fd675779.yaml

-> Derived from Service
X        ├── Endpoints_inventory-erik_inventory-postgresql-headless.yaml
X        ├── Endpoints_inventory-erik_inventory-postgresql.yaml
X        ├── Endpoints_inventory-erik_inventory.yaml
X        ├── EndpointSlice_inventory-erik_inventory-6m72v.yaml
X        ├── EndpointSlice_inventory-erik_inventory-postgresql-headless-bwgp2.yaml
X        ├── EndpointSlice_inventory-erik_inventory-postgresql-headless-kthtw.yaml
X        ├── EndpointSlice_inventory-erik_inventory-postgresql-hjcq6.yaml

-> Derived from StatefulSet
        ├── PersistentVolumeClaim_inventory-erik_data-inventory-postgresql-0.yaml

-> Derived from StatefulSet,Deployment
X        ├── Pod_inventory-erik_inventory-548b54bf7c-ptckb.yaml
X        ├── Pod_inventory-erik_inventory-postgresql-0.yaml
X        ├── ReplicaSet_inventory-erik_inventory-548b54bf7c.yaml

-> Derived from Deployment indirectly? (Because of SA for the Pod?)
        ├── Secret_inventory-erik_default-token-ktt5l.yaml
X        ├── ServiceAccount_inventory-erik_default.yaml

-> How do we handle helm objects? Strip for now?
        ├── Secret_inventory-erik_sh.helm.release.v1.inventory.v1.yaml

################################################################################

https://github.com/cooktheryan/gitops-primer/tree/main/extract/plugins

crane export --export-dir /tmp/export
crane transform --export-dir /tmp/export/resources --plugin-dir /opt --transform-dir /tmp/transform
crane apply --export-dir /tmp/export/resources --transform-dir /tmp/transform --output-dir /repo

Required args
Plugin debug experience
Default sane behavior
Accept arbitary JSONPatch as an input, maybe apply it to specific GVK as a passthrough
Access to logger within the plugin?
What to return in the event of errors?

---
Transfer

pvc-namespace argument is not clear, what is this actually referring
to? I expected the namespaces to be implied by the contexts?

The logs are not clear about what pods are not ready? Is it on
the source? Target?

# k logs rsync-wrpvs -c rsync
2021/08/26 01:41:21 [102] rsync: server sent "HTTP/1.1 400 Bad request" rather than greeting
2021/08/26 01:41:21 [102] rsync error: error starting client-server protocol (code 5) at main.c(1657) [sender=3.1.3]
rsync: server sent "HTTP/1.1 400 Bad request" rather than greeting
rsync error: error starting client-server protocol (code 5) at main.c(1657) [sender=3.1.3]

this is in the source
